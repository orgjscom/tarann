var program=require("commander"),async=require("async"),crypto=require("crypto"),config=require("../config"),mongoclient=require("mongodb").MongoClient,db;program.version(config.taracotjs).option("-m, --mongo [url]","Specify MongoDB connect URL").option("-s, --silent","Don't ask anything (perform silently)").option("-k, --keepstats","Keep statistics").parse(process.argv);var mongo_url=program.mongo||config.mongo.url,uninstall=function(){mongoclient.connect(mongo_url,config.mongo_options,function(o,n){o&&(console.log("\nCould not connect to the MongoDB. Please check config.js"),console.log(o),process.exit(1)),console.log("\nConnected to MongoDB"),db=n,db.collectionNames(function(o,n){o||n&&n.length&&(console.log("\nDropping all collections in database\n"),async.eachSeries(n,function(o,n){var e=o.name.replace(/^(\w+)\./,"");if(e.match(/^system\./))n();else{if("indexes"==e)return n();if("statistics"==e&&program.keepstats)return console.log(" [*] skipping statistics, --keepstats is in effect"),n();console.log(" [*] dropping: "+e),db.collection(e).drop(function(o){return o?n("\n [ERROR] cannot drop "+e+": "+o):(console.log(" [*] "+e+" has been dropped"),void n())})}},function(o){console.log(o?"\n[ERROR]: "+o:"\nAll done"),process.exit(0)}))})})};console.log("This script clean up the current database. All data will be lost.\n"),console.log("Database connection is required."),console.log("Current MongoDB URL: "+mongo_url+"\n"),program.silent?uninstall():program.confirm("Continue? ",function(o){o?uninstall():process.exit(0)});