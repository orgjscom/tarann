function generateId(o){o||(o=16);for(var n="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=0;o>s;s++)n+=e.charAt(Math.floor(Math.random()*e.length));return n}function ensure_indexes(o,n,e,s,l){var r={unique:!1,background:!0,dropDups:!1,w:1};e&&(r=e);for(var i=[],c=0;c<n.length;c++){var t={};if(t[n[c]]=1,i.push({col:o,ix:t}),!s){var u={};u[n[c]]=-1,i.push({col:o,ix:u})}}async.every(i,function(o,n){db.collection(o.col).ensureIndex(o.ix,function(){n(!0)})},function(o){l()})}var program=require("commander"),async=require("async"),config=require("../config"),mongoclient=require("mongodb").MongoClient,fs=require("fs"),modules=["settings","auth","cp","pages","parts","user"],db;program.version(config.taracotjs).option("-s, --silent","Don't ask anything (perform silently)").option("-m, --module [module]","Uninstall specified module only").parse(process.argv);var mongo_url=config.mongo.url,finst=function(){mongoclient.connect(mongo_url,config.mongo_options,function(o,n){if(o&&(console.log("\nCould not connect to the MongoDB. Please check config.js"),console.log(o),process.exit(1)),console.log("\nConnected to MongoDB\n"),db=n,program.module){fs.existsSync("../modules/"+program.module)&&fs.lstatSync("../modules/"+program.module).isDirectory()||(console.log("\nModule not found: "+program.module),process.exit(1));var e=require("../modules/"+program.module+"/install")(db,ensure_indexes,config);console.log("[*] Uninstalling module: "+e.name+" ("+e.version+")"),e.uninstall(function(o){o&&(console.log("\n[!] Fail: "+o),process.exit(code=1)),console.log("\nInstallation complete."),process.exit(code=0)})}else fs.readdir("../modules",function(o,n){o&&(console.log("\nCould not get modules list"),console.log(o),process.exit(1));var e={},s=[];for(var l in modules)e[modules[l]]=!0;for(var r in n)fs.lstatSync("../modules/"+n[r]).isDirectory()&&!e[n[r]]&&modules.push(n[r]);for(var i in modules){var c=require("../modules/"+modules[i]+"/install")(db,ensure_indexes,config);c&&s.push(c)}async.eachSeries(s,function(o,n){console.log("[*] Uninstalling module: "+o.name+" ("+o.version+")"),o.uninstall(function(o){o&&(console.log("\n[!] Fail: "+o),process.exit(code=1)),n()})},function(o){console.log("\nUninstall complete."),process.exit(code=0)})})})};console.log("This script will UNINSTALL modules from your TaracotJS installation. All data will be dropped.\n"),console.log("A working MongoDB connection is required."),console.log("Current MongoDB URL: "+mongo_url+"\n"),program.silent?finst():program.confirm("Do you wish to continue? ",function(o){o?finst():(console.log("\nAborted"),process.exit(code=0))});var dummy=function(){};