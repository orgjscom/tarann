var crypto=require("crypto"),async=require("async");module.exports=function(e,n,t){var r={name:"auth",version:"0.5.170",collections:function(n){async.series([function(n){e.createCollection("users",function(e,t){return e?n(e):void n()})}],function(e){return e?n(e):void n()})},indexes:function(e){n("users",["username","email","realname","status"],null,null,function(){n("users",["act_code","res_code","username_auth","password","username_vk_uid"],null,!0,function(){e()})})},defaults:function(n){e.collection("users").remove({username:"admin"},function(){var r=crypto.createHash("md5").update(t.salt+".admin").digest("hex");e.collection("users").insert({username:"admin",username_auth:"admin",email:"default@taracot.org",realname:"Website Administrator",status:2,regdate:Date.now(),password:r},function(e){return e&&e?callback(e):void n()})})},misc:function(e){e()},uninstall:function(n){var t=["users"];async.eachSeries(t,function(n,t){e.collection(n).drop(function(e){return e?t(e):void t()})},function(e){return e?n(e):void n()})}};return r};